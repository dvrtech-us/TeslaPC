<style>
    img {
        max-width: 100%;

        -webkit-user-drag: none;
        -khtml-user-drag: none;
        -moz-user-drag: none;
        -o-user-drag: none;
        user-drag: none;
    }
</style>


<img title="playback" style="max-width: 100%" src="http://LOCALHOST:8081" />
<button onclick="startAudioPlayback()"> start playback</button>

<!-- Include the WebSocket JavaScript library -->




<script>

    let audioContext = null
    let audioSocket = null;
    let pcmPlayerNode = null;

    async function startAudioPlayback() {
        console.log('Before AudioContext start');

        audioContext = new AudioContext({ sampleRate: 48000, channels: 2, latencyHint: 'interactive' });
        console.log('After AudioContext start');

        await audioContext.audioWorklet.addModule('PCMPlayerProcessor.js');
        console.log("starting audioContext");
        var pcmPlayerNode = new AudioWorkletNode(audioContext, 'pcm-player-processor');
        var audioSocket = new WebSocket('ws://LOCALHOST:8082/');
        pcmPlayerNode.connect(audioContext.destination);
        audioSocket.onmessage = function (event) {
            console.log('received message');
            pcmPlayerNode.port.postMessage(event.data);
        };
        audioContext.resume();
        console.log('after AudioContext resume');


    }

</script>




<script>
    // Create a WebSocket connection
    var mouseSocket = new WebSocket('ws://LOCALHOST:8080/ws/');

    // Get the image element
    var img = document.querySelector('img');

    // Add an event listener for the 'click' event
    img.addEventListener('click', function (event) {
        // Get the click coordinates relative to the image
        var rect = img.getBoundingClientRect();
        var x = event.clientX - rect.left;
        var y = event.clientY - rect.top;
        //take into account the image size vs the actual size
        //convert to integer
        x = parseInt(x);
        y = parseInt(y);

        // Send these coordinates over the WebSocket connection
        mouseSocket.send(JSON.stringify({
            Type: 'click',
            X: x,
            Y: y,
            DisplaySize: {
                width: img.width,
                height: img.height
            }
        }));

    });

    //add an event listener for the 'mousemove' event
    img.addEventListener('mousemove', function (event) {
        return;
        // Get the click coordinates relative to the image
        var rect = img.getBoundingClientRect();
        var x = event.clientX - rect.left;
        var y = event.clientY - rect.top;
        //take into account the image size vs the actual size
        //convert to integer
        x = parseInt(x);
        y = parseInt(y);

        // Send these coordinates over the WebSocket connection
        mouseSocket.send(JSON.stringify({
            Type: 'move',
            X: x,
            Y: y,
            DisplaySize: {
                width: img.width,
                height: img.height
            }
        }));

    });
    //Add event for mouse down
    img.addEventListener('mousedown', function (event) {
        // Get the click coordinates relative to the image
        var rect = img.getBoundingClientRect();
        var x = event.clientX - rect.left;
        var y = event.clientY - rect.top;
        //take into account the image size vs the actual size
        //convert to integer
        x = parseInt(x);
        y = parseInt(y);

        // Send these coordinates over the WebSocket connection
        mouseSocket.send(JSON.stringify({
            Type: 'down',
            X: x,
            Y: y,
            DisplaySize: {
                width: img.width,
                height: img.height
            }
        }));

    });
    //Add event for mouse up
    img.addEventListener('mouseup', function (event) {
        // Get the click coordinates relative to the image
        var rect = img.getBoundingClientRect();
        var x = event.clientX - rect.left;
        var y = event.clientY - rect.top;
        //take into account the image size vs the actual size
        //convert to integer
        x = parseInt(x);
        y = parseInt(y);

        // Send these coordinates over the WebSocket connection
        mouseSocket.send(JSON.stringify({
            Type: 'up',
            X: x,
            Y: y,
            DisplaySize: {
                width: img.width,
                height: img.height
            }
        }));

    });


</script>